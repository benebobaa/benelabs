---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPageBySlug } from '../../lib/sanity';

const page = await getPageBySlug('contact');
const title = page?.seo?.title ?? 'Contact | Benelabs';
const description =
  page?.seo?.description ?? 'Contact Benelabs to discuss AI, cloud, and backend engineering.';
const heading = page?.title ?? 'Ready to build something impactful?';
const intro =
  page?.intro ??
  'Share a few details about your project and we will respond within two business days. The first consultation is free.';
const body =
  page?.content ??
  `<p>We help teams with backend modernization, cloud platforms, AI automation, and mobile delivery. If you are unsure
  where to start, we can help scope the first milestone.</p>`;
---

<BaseLayout title={title} description={description} enableSessionReplay={true}>
  <section class="site-container section-block">
    <div class="grid gap-10 lg:grid-cols-[1fr_0.9fr]">
      <div class="space-y-4">
        <p class="eyebrow">Contact</p>
        <h1 class="text-[1.8rem] md:text-4xl">{heading}</h1>
        <p class="text-base text-pretty md:text-lg">{intro}</p>
        <div class="prose max-w-none" set:html={body} />
        <div class="card-surface card-pad space-y-3 text-sm text-[var(--color-ink-muted)]">
          <div class="eyebrow">Direct line</div>
          <a
            class="text-base font-semibold text-[var(--color-accent)]"
            href="mailto:hello@Benelabs.tech"
            data-analytics="email"
            data-label="contact_email"
          >
            hello@Benelabs.tech
          </a>
          <a
            class="text-sm text-[var(--color-ink-muted)]"
            href="https://www.linkedin.com/in/benediktus-satriya/"
          >
            LinkedIn
          </a>
          <a class="text-sm text-[var(--color-ink-muted)]" href="https://medium.com/@bensatriya3">
            Medium
          </a>
          <p>Based in Jakarta, Indonesia, working globally on AI, cloud, and backend delivery.</p>
        </div>
      </div>
      <form
        class="card-surface card-pad grid gap-4"
        action="/api/contact"
        method="post"
        data-analytics-form="contact"
        data-ph-no-capture
      >
        <input type="hidden" name="distinctId" data-analytics-distinct-id />
        <div class="grid gap-2">
          <label class="text-sm font-semibold text-[var(--color-ink)]" for="name">Name</label>
          <input
            class="min-h-[44px] rounded-[var(--radius-sm)] border border-[var(--color-border)] px-3 py-2 text-sm"
            id="name"
            name="name"
            type="text"
            placeholder="Your name"
            data-ph-mask
          />
        </div>
        <div class="grid gap-2">
          <label class="text-sm font-semibold text-[var(--color-ink)]" for="email">Email</label>
          <input
            class="min-h-[44px] rounded-[var(--radius-sm)] border border-[var(--color-border)] px-3 py-2 text-sm"
            id="email"
            name="email"
            type="email"
            placeholder="you@company.com"
            required
            data-ph-mask
          />
        </div>
        <div class="grid gap-2">
          <label class="text-sm font-semibold text-[var(--color-ink)]" for="details">Project details</label>
          <textarea
            class="min-h-[140px] rounded-[var(--radius-sm)] border border-[var(--color-border)] px-3 py-2 text-sm"
            id="details"
            name="details"
            placeholder="Tell us about your timeline, goals, and scope."
            required
            data-ph-mask
          ></textarea>
        </div>
        <button class="button-primary w-fit" type="submit" data-analytics="contact-submit">
          Book a free consultation
        </button>
        <p class="text-xs text-[var(--color-ink-subtle)]">
          This form sends via Resend once the required environment variables are configured.
        </p>
      </form>
    </div>
  </section>
  <script>
    const form = document.querySelector('[data-analytics-form="contact"]');
    const distinctInput = form?.querySelector('[data-analytics-distinct-id]');

    const updateDistinct = (value) => {
      if (!distinctInput || !value) return;
      distinctInput.value = value;
    };

    updateDistinct(window.__posthogDistinctId);

    form?.addEventListener('submit', () => {
      updateDistinct(window.__posthogDistinctId);
    });

    document.addEventListener('posthog:ready', (event) => {
      updateDistinct(event.detail?.distinctId);
    });
  </script>
</BaseLayout>
